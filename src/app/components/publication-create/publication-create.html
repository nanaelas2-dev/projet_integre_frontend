<div class="container">
  <h2>Nouvelle Publication</h2>
  <form [formGroup]="pubForm" (ngSubmit)="onSubmit()">
    <!-- Categorie & Description -->
    <div class="form-group">
      <label for="categorie">CatÃ©gorie</label>
      <select id="categorie" formControlName="categorie">
        <option value="" disabled>SÃ©lectionner une catÃ©gorie</option>

        @for (cat of categories; track cat) {
        <option [value]="cat">{{cat}}</option>
        }
      </select>

      @if (pubForm.get('categorie')?.touched && pubForm.get('categorie')?.invalid) {
      <div class="error">La catÃ©gorie est requise.</div>
      }
    </div>

    <div class="form-group">
      <label for="description">Description</label>
      <textarea
        id="description"
        rows="5"
        formControlName="description"
        placeholder="De quoi parle votre publication ?"
      >
      </textarea>

      @if (pubForm.get('description')?.touched && pubForm.get('description')?.invalid) {
      <div class="error">La description est requise (min 10 caractÃ¨res).</div>
      }
    </div>

    <!-- === ATTACHMENT SECTION === -->
    <div class="form-group attachment-section">
      <label>Ajouter un contenu</label>

      <!-- TABS to switch modes -->
      <div class="tabs">
        <button type="button" [class.active]="mode() === 'FILE'" (click)="setMode('FILE')">
          ðŸ“· Fichier (Image/PDF)
        </button>
        <button type="button" [class.active]="mode() === 'LINK'" (click)="setMode('LINK')">
          ðŸ”— Lien (YouTube/Site)
        </button>
      </div>

      <!-- FILE UPLOAD -->
      @if (mode() === 'FILE') {
      <div class="file-upload-box">
        <input #fileInput type="file" (change)="onFileSelected($event)" style="display: none" />

        <button type="button" class="btn-select" (click)="fileInput.click()">
          {{ selectedFile() ? 'Changer le fichier' : 'Choisir un fichier' }}
        </button>

        @if (selectedFile()) {
        <span class="filename">Selected: {{ selectedFile()?.name }}</span>
        }
      </div>
      }

      <!-- LINK INPUT -->
      @if (mode() === 'LINK') {
      <input type="text" formControlName="lien" placeholder="Collez votre lien ici (ex: YouTube)" />
      }
    </div>

    <div class="actions">
      <button type="button" routerLink="/dashboard" class="btn-cancel">Annuler</button>
      <button type="submit" [disabled]="pubForm.invalid" class="btn-submit">Publier</button>
    </div>
  </form>
</div>
